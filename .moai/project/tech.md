# TFT Panel FPGA Controller - 기술 사양

## 시스템 사양

### 타이밍 요구사항

| 파라미터 | 값 | 허용 오차 | 설명 |
|----------|-----|-----------|------|
| **시스템 클럭** | 100 MHz | +/- 50 ppm | 기준 클럭 |
| **행 클럭** | 5 MHz | +/- 1% | row_clk_en 출력 |
| **열 클럭** | 10 MHz | +/- 1% | col_clk_en 출력 |
| **ADC 클럭** | 최대 20 MHz | +/- 1% | adc_clk 출력 |
| **SPI 클럭** | 최대 10 MHz | - | SPI 슬레이브 동작 |
| **바이어스 전환** | < 10 us | - | 모드 간 전환 시간 |
| **프레임 시간** | < 250 ms | - | 전체 프레임 획득 |

### 클럭 도메인

```
clk_100mhz (기준)
    │
    ├─> clk_5mhz   (행 클럭, 분주비 20)
    ├─> clk_10mhz  (열 클럭, 분주비 10)
    └─> clk_adc    (ADC 클럭, 분주비 5)
```

### 주요 타이밍 다이어그램

#### 프레임 캡처 순서
```
      0us         10us         100ms           202.4ms      250ms
      │           │            │               │            │
IDLE  RESET    INTEGRATE    READOUT        COMPLETE      IDLE
      │           │            │               │            │
      └─reset_pulse─┘          └─row/col_clk─┘            │
                                     └─adc_read─┘         │
                                                          └─interrupt
```

#### 바이어스 모드 전환
```
NORMAL_BIAS        SLEEP_BIAS         IDLE_LOW_BIAS
    │                  │                    │
    │<───── 10us ─────>|<───── 10us ──────>│
    │                  │                    │
    └─ bias_busy ──────┴─ bias_busy ────────┘
```

## 인터페이스 프로토콜

### SPI 슬레이브 인터페이스

#### 프로토콜 사양
- **모드**: SPI Mode 0 (CPOL=0, CPHA=0)
- **데이터 폭**: 8비트
- **최대 클럭**: 10 MHz
- **바이트 순서**: LSB First

#### 전송 포맷
```
CS_N    ────────────┐              ┌────────
SCLK    ┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐
MOSI    A7 A6 A5 A4 A3 A2 A1 A0 D31...D0
MISO    ZZZZZZZZZZZZZZ D31...D0
        └─ Address Phase (8 bits) ─┘└─ Data Phase (32 bits) ─┘
```

#### 레지스터 맵

| 주소 | 이름 | 접근 | 리셋 값 | 설명 |
|------|------|------|---------|------|
| 0x00 | CTRL_REG | RW | 0x00 | 제어 레지스터 |
| 0x01 | STATUS_REG | RO | 0x01 | 상태 레지스터 |
| 0x02 | BIAS_SELECT | RW | 0x00 | 바이어스 모드 선택 |
| 0x03-04 | DUMMY_PERIOD | RW | 0x003C | 더미 스캔 주기 (초) |
| 0x05 | DUMMY_CONTROL | RW | 0x00 | 더미 스캔 제어 |
| 0x06-07 | ROW_START | RW | 0x0000 | ROI 시작 행 |
| 0x08-09 | ROW_END | RW | 0x07FF | ROI 종료 행 (2047) |
| 0x0A-0B | COL_START | RW | 0x0000 | ROI 시작 열 |
| 0x0C-0D | COL_END | RW | 0x07FF | ROI 종료 열 (2047) |
| 0x0E-0F | INTEGRATION_TIME | RW | 0x0064 | 통합 시간 (ms) |
| 0x10-11 | ROW_CLK_DIV | RW | 0x0014 | 행 클럭 분주비 (20) |
| 0x12-13 | COL_CLK_DIV | RW | 0x000A | 열 클럭 분주비 (10) |
| 0x14-15 | INTERRUPT_MASK | RW | 0x0000 | 인터럽트 마스크 |
| 0x16-17 | INTERRUPT_STATUS | W1C | 0x0000 | 인터럽트 상태 |
| 0x18 | ERROR_CODE | RO | 0x00 | 에러 코드 |
| 0x23 | FIRMWARE_VERSION | RO | 0x10 | 펌웨어 버전 (1.0) |
| 0x20-3F | TEST_PATTERN | RW | 0x00 | 테스트 패턴 (256 bytes) |

### ADC 인터페이스

#### SPI 타이밍 (ADC 칩)
- **CS 활성화**: 변환 시작
- **SCLK 주파수**: 최대 20 MHz
- **비트 수**: 14비트
- **변환 시간**: 최대 10 클럭 사이클

#### 데이터 포맷
```
MSB ──────────────────────────── LSB
  D13  D12  D11  D10  D09  D08  D07
  D06  D05  D04  D03  D02  D01  D00
```

## 전기적 사양

### 전압 레벨

| 신호 그룹 | I/O 표준 | 전압 | 설명 |
|-----------|----------|------|------|
| 시스템 IO | LVCMOS33 | 3.3V | 일반 입출력 |
| SPI 인터페이스 | LVCMOS33 | 3.3V | MCU 통신 |
| 패널 제어 | LVCMOS33 | 3.3V | 패널 신호 |
| ADC 인터페이스 | LVCMOS33 | 3.3V | ADC 통신 |

### 바이어스 전압

| 모드 | V_PD | V_COL | V_RG | 전류 소비 |
|------|------|-------|------|-----------|
| NORMAL | -1.5V | -1.0V | - | 정상 |
| IDLE | -0.2V | -0.2V | - | 절전 |
| SLEEP | 0V | 0V | - | 최소 |

### 전력 소비

| 조건 | 예상 소비 전력 |
|------|----------------|
| 활성 (이미징) | ~500 mW |
| 유휴 (IDLE) | ~200 mW |
| 절전 (SLEEP) | ~50 mW |

## 성능 요구사항

### 처리량

| 파라미터 | 값 | 설명 |
|----------|-----|------|
| 최대 프레임률 | 4 fps | 250ms/프레임 |
| 픽셀 처리 속도 | 16.8 MPix/s | 2048x2048 / 250ms |
| 데이터 처리량 | ~235 Mbps | 14비트 x 16.8Mpix/s |

### 지연 시간

| 경로 | 최대 지연 |
|------|-----------|
| SPI 쓰기 -> 레지스터 | < 2 us |
| 바이어스 모드 전환 | < 10 us |
| 프레임 시작 -> 첫 픽셀 | < 20 us |
| 인터럽트 발생 | < 1 클럭 (10ns) |

### 메모리 요구사항

| 리소스 | 사용량 | 한도 | 활용률 |
|--------|--------|------|--------|
| Slice LUTs | ~10,000 | 20,800 | ~48% |
| Slice Registers | ~12,000 | 41,600 | ~29% |
| BRAM | ~20 | 50 | ~40% |
| MMCM/PLL | 1 | 2 | ~50% |

## 신호 무결성

### 셋업/홀드 시간

| 파라미터 | 최소 | 최대 | 단위 |
|----------|------|------|------|
| 셋업 시간 (tsu) | 0.5 | - | ns |
| 홀드 시간 (th) | 0.2 | - | ns |
| 클럭-to-Q (tco) | - | 1.0 | ns |

### 전파 지연

| 경로 | 최대 지연 | 단위 |
|------|-----------|------|
| 클럭 -> 출력 | 5.0 | ns |
| 입력 -> 출력 | 10.0 | ns |
| 클럭 -> 셋업 | 15.0 | ns |

## 동작 조건

### 환경 사양

| 파라미터 | 최소 | 최대 | 단위 |
|----------|------|------|------|
| 동작 온도 | 0 | 70 | C |
| 보관 온도 | -40 | 85 | C |
| 공급 전압 | 3.135 | 3.465 | V |
| 습도 | 10 | 90 | % RH |

### 신뢰성

| 항목 | 사양 |
|------|------|
| MTBF | > 50,000 시간 |
| FIT율 | < 100 |
| 수명 주기 | > 10년 |

## 합성 및 구현 가이드라인

### 타이밍 제약 (TCL)

```tcl
# 기준 클럭
create_clock -period 10.000 -name clk [get_ports clk]

# 입력 지연
set_input_delay -clock clk -max 20.0 [get_ports {spi_cs_n spi_mosi spi_sclk}]

# 출력 지연
set_output_delay -clock clk -max 20.0 [get_ports spi_miso]

# 거위 경로 (비동기 리셋)
set_false_path -from [get_ports rst_n]
```

### 중요 경로

1. **SPI 경로**: MCU에서 FPGA로의 SPI 신호
2. **ADC 경로**: ADC 데이터 캡처 경로
3. **패널 클럭 경로**: 행/열 클럭 생성
4. **인터럽트 경로**: 인터럽트 신호 생성

---

문서 버전: 1.0
최종 업데이트: 2026-02-11
